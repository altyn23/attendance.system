<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Тіркелу</title>
  <style>
    :root {
      --primary: #2e5ccd;
      --accent: #5eb680;
      --text-dark: #1e293b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(115deg, #1e3a8a 0%, #172554 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dark);
    }
    .container {
      width: 460px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border-radius: 24px;
      padding: 34px 28px 36px;
      box-shadow: 0 8px 35px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    h1 { font-size: 26px; color: #fff; margin: 0 0 6px; text-align:center; }
    .subtitle { color: rgba(255,255,255,.75); text-align:center; margin: 0 0 20px; font-size:14px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .full { grid-column: span 2; }
    label { display: block; font-size: 13px; color: #e2e8f0; margin-bottom: 6px; }
    input {
      width: 100%;
      padding: 11px 12px;
      border-radius: 9px;
      border: none;
      font-size: 14px;
      outline: none;
      background: rgba(255,255,255,.92);
    }
    .btn {
      margin-top: 16px;
      width: 100%;
      background: var(--primary);
      border: none;
      border-radius: 10px;
      color: #fff;
      padding: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .note {
      margin-top: 12px;
      color: rgba(255,255,255,.82);
      font-size: 12px;
      line-height: 1.5;
      text-align: center;
    }
    .link { margin-top: 14px; text-align:center; color: rgba(255,255,255,.82); font-size: 14px; }
    .link a { color: var(--accent); text-decoration:none; font-weight:600; }
    .msg { display:none; margin-bottom: 14px; padding: 10px 12px; border-radius: 8px; font-size: 13px; }
    .error { background: rgba(255,87,87,.15); color: #fee2e2; border-left: 4px solid #e63946; }
    .success { background: rgba(94,182,128,.2); color: #ecfdf5; border-left: 4px solid var(--accent); }
    @media (max-width: 540px) {
      .container { width: 92%; }
      .grid { grid-template-columns: 1fr; }
      .full { grid-column: span 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Тіркелу</h1>
    <p class="subtitle">Студент аккаунтын ашу</p>

    <div id="msg" class="msg"></div>

    <div class="grid">
      <div>
        <label for="firstName">Аты *</label>
        <input id="firstName" type="text" required />
      </div>
      <div>
        <label for="lastName">Тегі *</label>
        <input id="lastName" type="text" required />
      </div>
      <div class="full">
        <label for="email">Email *</label>
        <input id="email" type="email" required />
      </div>
      <div>
        <label for="phone">Телефон</label>
        <input id="phone" type="tel" />
      </div>
      <div>
        <label for="group">Топ</label>
        <input id="group" type="text" placeholder="ИС-2101" />
      </div>
      <div>
        <label for="department">Бөлім</label>
        <input id="department" type="text" />
      </div>
      <div>
        <label for="password">Құпиясөз *</label>
        <input id="password" type="password" required />
      </div>
      <div>
        <label for="confirmPassword">Құпиясөзді растау *</label>
        <input id="confirmPassword" type="password" required />
      </div>
    </div>

    <button class="btn" onclick="register()">Тіркелу</button>

    <p class="note">Оқытушы және админ аккаунттары тек жүйе әкімшісі арқылы қосылады.</p>

    <div class="link">
      Аккаунтыңыз бар ма? <a href="/login">Кіру</a>
    </div>
  </div>

  <script>
    const msg = document.getElementById("msg");

    async function register() {
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const group = document.getElementById("group").value.trim();
      const department = document.getElementById("department").value.trim();
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      msg.style.display = "none";

      if (!firstName || !lastName || !email || !password) {
        showMsg("Міндетті өрістерді толтырыңыз", "error");
        return;
      }
      if (password !== confirmPassword) {
        showMsg("Құпиясөздер сәйкес емес", "error");
        return;
      }
      if (password.length < 6) {
        showMsg("Құпиясөз кемінде 6 символ болуы керек", "error");
        return;
      }

      try {
        const res = await fetch("/api/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ firstName, lastName, email, phone, password, department, group })
        });
        const data = await res.json();
        if (!res.ok || data.error) {
          showMsg(data.error || "Тіркеу қатесі", "error");
          return;
        }

        showMsg("Тіркелу сәтті. Кіру бетіне бағытталуда.", "success");
        setTimeout(() => { window.location.href = "/login"; }, 1500);
      } catch (_) {
        showMsg("Серверге қосылу мүмкін емес", "error");
      }
    }

    function showMsg(text, type) {
      msg.textContent = text;
      msg.className = "msg " + type;
      msg.style.display = "block";
    }
  </script>
<script src="/js/app-prefs.js"></script>
</body>
</html>
